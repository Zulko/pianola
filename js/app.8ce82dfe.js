(function(e){function t(t){for(var n,a,o=t[0],l=t[1],c=t[2],d=0,m=[];d<o.length;d++)a=o[d],Object.prototype.hasOwnProperty.call(r,a)&&r[a]&&m.push(r[a][0]),r[a]=0;for(n in l)Object.prototype.hasOwnProperty.call(l,n)&&(e[n]=l[n]);u&&u(t);while(m.length)m.shift()();return s.push.apply(s,c||[]),i()}function i(){for(var e,t=0;t<s.length;t++){for(var i=s[t],n=!0,o=1;o<i.length;o++){var l=i[o];0!==r[l]&&(n=!1)}n&&(s.splice(t--,1),e=a(a.s=i[0]))}return e}var n={},r={app:0},s=[];function a(t){if(n[t])return n[t].exports;var i=n[t]={i:t,l:!1,exports:{}};return e[t].call(i.exports,i,i.exports,a),i.l=!0,i.exports}a.m=e,a.c=n,a.d=function(e,t,i){a.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},a.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},a.t=function(e,t){if(1&t&&(e=a(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(a.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)a.d(i,n,function(t){return e[t]}.bind(null,n));return i},a.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return a.d(t,"a",t),t},a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},a.p="/pianola/";var o=window["webpackJsonp"]=window["webpackJsonp"]||[],l=o.push.bind(o);o.push=t,o=o.slice();for(var c=0;c<o.length;c++)t(o[c]);var u=l;s.push([0,"chunk-vendors"]),i()})({0:function(e,t,i){e.exports=i("56d7")},1:function(e,t){},"18c3":function(e,t,i){},"1b26":function(e,t,i){"use strict";i("8143")},"2f67":function(e,t,i){},"37bb":function(e,t,i){"use strict";i("8eb9")},5023:function(e,t,i){"use strict";i("18c3")},"56d7":function(e,t,i){"use strict";i.r(t);i("e260"),i("e6cf"),i("cca6"),i("a79d");var n=i("2b0e"),r=i("289d"),s=i("28dd"),a=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{attrs:{id:"app"}},[e._m(0),e.midiFileData.fileName?e._e():i("midi-uploader",{on:{input:function(t){e.midiFileData=t}}}),e.midiFileData.fileName?i("file-infos",{attrs:{fileName:e.midiFileData.fileName,infos:e.midiFileData.infos},on:{change:function(t){e.midiFileData={fileName:null,midiEvents:[]}}}}):e._e(),e.midiFileData.fileName?i("player",{attrs:{midiEvents:e.midiEvents}}):e._e()],1)},o=[function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"header"},[i("h1",[e._v("Pianola")]),i("h2",[e._v("A web MIDI piano player")])])}],l=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"midi-uploader"},[i("b-upload",{attrs:{multiple:!1,"drag-drop":!0},on:{input:e.parseMidi}},[i("section",{staticClass:"section"},[i("div",{staticClass:"content has-text-centered"},[i("p",[i("b-icon",{attrs:{icon:"upload",size:"is-large"}})],1),i("p",[e._v("Drop a one-track MIDI file")])])])]),i("div",{staticClass:"load-example"},[i("a",{on:{click:function(t){return e.loadExample(e.publicPath+"chopin_valse_op64_no1.mid")}}},[e._v("Load an example")])])],1)},c=[],u=(i("4160"),i("caad"),i("fb6a"),i("b0c0"),i("ac1f"),i("1276"),i("159b"),i("5530")),d=i("c74e"),m=i.n(d),f={data:function(){return{publicPath:"/pianola/"}},methods:{parseMidi:function(e,t){var i=this,n=new FileReader;n.onload=function(n){var r=m()(n.target.result),s=i.midiDataToInfoAndEventTimes(r),a=s.midiEvents,o=s.infos;i.$emit("input",{fileName:t||e.name,midiEvents:a,infos:o})},n.readAsBinaryString(e)},midiDataToInfoAndEventTimes:function(e){var t={infos:[],midiEvents:[]},i={beatsPerTick:1/e.header.ticksPerBeat,secondsPerTick:0};return e.tracks.forEach((function(e){var n=0;e.forEach((function(e){if(e.deltaTime&&(n+=e.deltaTime*i.secondsPerTick),"setTempo"===e.subtype){var r=e.microsecondsPerBeat/1e6;i.secondsPerTick=r*i.beatsPerTick}"meta"===e.type&&t.infos.push(e.text),["noteOn","noteOff"].includes(e.subtype)&&t.midiEvents.push(Object(u["a"])(Object(u["a"])({},e),{},{timeSeconds:n}))}))})),t.midiEvents.sort((function(e,t){return e.timeSeconds-t.timeSeconds})),t},loadExample:function(e){var t=this;this.$http.get(e,{responseType:"blob"}).then((function(i){t.parseMidi(i.bodyBlob,e.split("/").slice(-1)[0])}))}}},p=f,h=(i("37bb"),i("2877")),y=Object(h["a"])(p,l,c,!1,null,null,null),v=y.exports,b=function(){var e=this,t=e.$createElement,i=e._self._c||t;return e.fileName?i("div",{staticClass:"file-infos",model:{value:e.fileName,callback:function(t){e.fileName=t},expression:"fileName"}},[i("p",[e._v(e._s(e.fileName)),i("a",{on:{click:function(t){return e.$emit("change")}}},[e._v("[Change]")]),i("b-collapse",{attrs:{open:!1}},[i("a",{attrs:{slot:"trigger"},slot:"trigger"},[e._v("[Infos]")]),i("div",{staticClass:"infos"},[i("hr"),i("h2",[e._v("Infos")]),i("ul"),e._l(e.infos,(function(t){return t?i("li",[e._v(e._s(t))]):e._e()})),i("hr")],2)])],1)]):e._e()},g=[],_={props:{fileName:{type:String},infos:{type:Array}}},k=_,x=(i("7345"),Object(h["a"])(k,b,g,!1,null,null,null)),T=x.exports,w=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"player"},[i("b-field",{attrs:{label:"Time"}},[i("b-slider",{staticClass:"time-segment-selector",attrs:{"custom-formatter":e.timeTooltipFormatter,step:.1,min:0,max:e.duration,indicator:""},model:{value:e.currentTime,callback:function(t){e.currentTime=t},expression:"currentTime"}})],1),i("b-field",{attrs:{label:"Region selector"}},[i("b-slider",{staticClass:"time-segment-selector",attrs:{"custom-formatter":e.timeTooltipFormatter,min:0,max:e.duration},model:{value:e.timeRegion,callback:function(t){e.timeRegion=t},expression:"timeRegion"}})],1),i("b-field",{attrs:{label:"Segment selector"}},[i("b-slider",{staticClass:"time-segment-selector",attrs:{min:e.timeRegion[0],max:e.timeRegion[1],step:.1,"custom-formatter":e.timeTooltipFormatter},model:{value:e.timeSegment,callback:function(t){e.timeSegment=t},expression:"timeSegment"}})],1),i("roll-view",{attrs:{currentTime:e.currentTime,midiEvents:e.midiEvents,region:e.timeRegion,segment:e.timeSegment}}),i("piano-keyboard",{attrs:{pressedKeys:e.pressedKeys}}),i("b-field",{staticClass:"controls",attrs:{grouped:""}},[i("b-button",{on:{click:function(t){e.isPlaying=!e.isPlaying}}},[e._v(e._s(e.isPlaying?"Pause":"Play"))]),i("b-field",{attrs:{label:"Speed factor","label-position":"on-border"}},[i("b-select",{model:{value:e.speedFactor,callback:function(t){e.speedFactor=t},expression:"speedFactor"}},e._l([10,20,50,80,100,120,150,200],(function(t){return i("option",{key:t,domProps:{value:t/100}},[e._v(e._s(t+"%"))])})),0)],1)],1)],1)},N=[],S=(i("99af"),i("4de4"),i("a9e3"),i("b680"),i("2909")),E=i("3835"),O=i("405e"),P=i.n(O),C=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"keyboard"},[i("svg",{staticClass:"keyboard-svg",staticStyle:{"background-color":"blue"},attrs:{height:.6*e.scale*100,viewBox:"0 0 1040 100",preserveAspectRatio:"none",xmlns:"http://www.w3.org/2000/svg"}},[e._l(88,(function(t){return e.midiNoteIsBlackKey(t)?e._e():i("piano-key",{key:"white-"+t,attrs:{midiNote:t,isPressed:e.pressedKeys.includes(t+20)}})})),e._l(88,(function(t){return e.midiNoteIsBlackKey(t)?i("piano-key",{key:"black-"+t,attrs:{midiNote:t,isPressed:e.pressedKeys.includes(t+20)}}):e._e()}))],2)])},F=[],j=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("g",{staticClass:"piano-key"},[e.isBlackKey?i("g",[i("rect",{style:"fill:"+(e.isPressed?"#black":"#222222")+";z-index: 0;",attrs:{width:"14",height:"60",x:e.keyCenterX-7}}),e.isPressed?i("ellipse",{staticStyle:{fill:"yellow",stroke:"black","stroke-width":"3"},attrs:{cx:e.keyCenterX,cy:40,rx:6,ry:18}}):e._e()]):i("g",[i("rect",{style:"fill:"+(e.isPressed?"#dddddd":"white")+";stroke:black;stroke-width:1; z-index: 1;",attrs:{width:"20",height:"100",x:e.keyCenterX-10}}),e.isPressed?i("ellipse",{staticStyle:{fill:"yellow",stroke:"black","stroke-width":"3"},attrs:{cx:e.keyCenterX,cy:80,rx:5,ry:15}}):e._e()])])},K=[];function A(e){return{octave:Math.floor((e+8)/12),note:(e+8)%12}}function D(e){var t=A(e),i=t.note;return[1,3,6,8,10].includes(i)}var I={props:{midiNote:{type:Number},isPressed:{type:Boolean}},data:function(){var e=A(this.midiNote),t=e.octave,i=e.note;return{keyCenterX:10*(14*t+i+(i>4))-90,isBlackKey:D(this.midiNote)}},methods:{}},M=I,R=Object(h["a"])(M,j,K,!1,null,null,null),B=R.exports,$={props:{pressedKeys:{default:function(){return[]},type:Array},scale:{default:1,type:Number}},components:{"piano-key":B},methods:{midiNoteIsBlackKey:function(e){return D(e)}}},L=$,X=(i("1b26"),Object(h["a"])(L,C,F,!1,null,null,null)),z=X.exports,J=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"roll-view"},[i("svg",{staticClass:"roll-svg",attrs:{height:200,viewBox:e.region[0]+" 0 "+(e.region[1]-e.region[0])+" 88",preserveAspectRatio:"none",xmlns:"http://www.w3.org/2000/svg"}},[i("rect",{staticClass:"background",staticStyle:{fill:"#ebe9e4"},attrs:{width:e.duration,height:"88",x:0,y:0}}),i("rect",{staticClass:"segment",staticStyle:{fill:"#fffaed"},attrs:{width:e.segment[1]-e.segment[0],height:"88",x:e.segment[0],y:0}}),i("rect",{staticClass:"cursor",staticStyle:{fill:"#d16060"},attrs:{width:.2,height:"88",x:e.currentTime,y:0}}),e._l(e.notes,(function(e,t){return i("rect",{key:t,staticClass:"note",staticStyle:{fill:"black"},attrs:{width:e.duration,height:"1",x:e.timeSeconds,y:109-e.noteNumber}})}))],2)])},H=[],q={props:{midiEvents:{type:Array},currentTime:{type:Number},region:{type:Array},segment:{type:Array}},data:function(){var e=[],t={};this.midiEvents.forEach((function(i){if("noteOn"===i.subtype&&(t[i.noteNumber]=i),"noteOff"===i.subtype){var n=t[i.noteNumber];e.push(Object(u["a"])(Object(u["a"])({},n),{},{duration:i.timeSeconds-n.timeSeconds}))}}));var i=e.slice(-1)[0],n=Math.ceil(i.timeSeconds+i.duration);return{notes:e,duration:n}}},G=q,Q=(i("5023"),Object(h["a"])(G,J,H,!1,null,null,null)),U=Q.exports,V={props:{midiEvents:{type:Array},readingInterval:{type:Number,default:.5}},data:function(){var e=this.midiEvents.slice(-1)[0].timeSeconds;return{pressedKeys:[],duration:e,timeRegion:[0,e],timeSegment:[0,e],currentTime:0,lastRead:{time:0,index:0},speedFactor:1,isPlaying:!1,audioContext:null,instrumentName:"acoustic_grand_piano",instrument:null,volumeFactor:1,noteSounds:{},nextLoopTimeOut:null}},components:{"piano-keyboard":z,"roll-view":U},methods:{timeTooltipFormatter:function(e){return"".concat(Math.floor(e/60),":").concat((e%60).toFixed(1))},playLoop:function(){var e=this,t=Object(E["a"])(this.timeSegment,2),i=t[0],n=t[1],r=Math.min(n,this.currentTime+this.speedFactor*this.readingInterval),s=this.midiEvents;this.currentTime>this.lastRead.time&&(s=s.slice(this.lastRead.index,s.length));var a=s.filter((function(t){return t.timeSeconds>=e.currentTime&&t.timeSeconds<r})),o=this;a.forEach((function(t){setTimeout((function(){"noteOff"===t.subtype?(o.noteSounds[t.noteNumber].stop(),o.pressedKeys=e.pressedKeys.filter((function(e){return e!==t.noteNumber}))):(o.noteSounds[t.noteNumber]=o.instrument.play(t.noteNumber,o.audioContext.currentTime,{gain:t.velocity/128}),o.pressedKeys=[].concat(Object(S["a"])(e.pressedKeys),[t.noteNumber]))}),1e3*(t.timeSeconds-e.currentTime)/e.speedFactor)})),this.nextLoopTimeOut=setTimeout((function(){if(o.isPlaying){var e=o.currentTime+o.speedFactor*o.readingInterval;e>n?(o.currentTime=i,o.pressedKeys=[]):o.currentTime=e,o.playLoop()}}),1e3*this.readingInterval)},releaseAllNotes:function(){var e=this;this.pressedKeys.forEach((function(t){return e.noteSounds[t].stop()})),this.pressedKeys=[]}},watch:{isPlaying:function(e){if(e)this.playLoop();else{var t=this;setTimeout((function(){t.releaseAllNotes()}),1500*this.readingInterval)}},timeSegment:{deep:!0,handler:function(e){this.releaseAllNotes();var t=Object(E["a"])(e,1);this.currentTime=t[0]}}},mounted:function(){var e=this;this.audioContext=new AudioContext({latencyHint:"interactive"}),P.a.instrument(this.audioContext,this.instrumentName,{soundfont:"MusyngKite"}).then((function(t){e.instrument=t}))},beforeDestroy:function(){clearTimeout(this.nextLoopTimeOut)}},W=V,Y=(i("6131"),Object(h["a"])(W,w,N,!1,null,null,null)),Z=Y.exports,ee={name:"App",data:function(){return{midiFileData:{fileName:null,midiEvents:[]}}},components:{"midi-uploader":v,"file-infos":T,player:Z},computed:{midiEvents:function(){return this.midiFileData?this.midiFileData.midiEvents:[]}}},te=ee,ie=(i("5c0b"),Object(h["a"])(te,a,o,!1,null,null,null)),ne=ie.exports;i("5abe");n["a"].use(s["a"]),n["a"].use(r["a"]),n["a"].config.productionTip=!1,new n["a"]({render:function(e){return e(ne)}}).$mount("#app")},"598a":function(e,t,i){},"5c0b":function(e,t,i){"use strict";i("9c0c")},6131:function(e,t,i){"use strict";i("2f67")},7345:function(e,t,i){"use strict";i("598a")},8143:function(e,t,i){},"8eb9":function(e,t,i){},"9c0c":function(e,t,i){}});
//# sourceMappingURL=app.8ce82dfe.js.map